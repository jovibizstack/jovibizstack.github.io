{"name":"engineering notes","tagline":"agora","body":"### [Javascript page performance tips from Slideshare](http://engineering.slideshare.net/2013/10/10-ways-we-made-slideshare-faster/)\r\n\r\n## 1. Load all third party libraries after window.load\r\n\r\nTo start with, all the javascript required for social sharing widgets eg. Facebook like button should be loaded asynchronously. \r\nAs a second step, move the script tags from the html page to a JavaScript(JS) file and bind the asynchronous loading of the external JS libraries to window.loadevent. \r\nFor example, to load FB Like Button, place the following code in the JS file included in the head\r\n```\r\n$(window).load(function(){\r\n  (function(d){\r\n    var js, id = 'facebook-jssdk',\r\n    ref = d.getElementsByTagName('script')[0];\r\n    if (d.getElementById(id)) { return; }\r\n    js = d.createElement('script'); \r\n    js.id = id; \r\n    js.async = true;\r\n    js.src = \"//connect.facebook.net/en_US/all.js\";\r\n    ref.parentNode.insertBefore(js, ref);\r\n  }(document));\r\n}\r\n```\r\n\r\n## 2. Asynchronously Load Jquery\r\n\r\nAnother useful trick is to load jQuery asynchronously so that other components on the page are not blocked. We used jql plugin which can be inlined in the HTML page. You don’t have to worry about missing document.ready( ) calls since jQl automatically catches all jQuery().ready() calls and executes them as soon as jQuery is loaded and the DOM is ready.\r\n\r\n## 3. Combine and Compress\r\n\r\nCombining the JS files help in eliminating the initial DNS lookup and TCP connection components that goes in every request. This is very evident from Yslow requests but an interesting tweak to this will be conditional compiling. For example let’s say your page requires jquery, file1.js, logged_in.js, logged_out.js.\r\n\r\nConditional compiling should give you \r\n\r\n```\r\ncombined_logged_in.js[jquery+file1.js+logged_in.js] and combined_logged_out.js[jquery+file1.js+logged_out.js]\r\n```\r\n\r\nFor compressing JS , closure compiler is known to give the best results.\r\n\r\n## 4. Smarter JS packaging\r\n\r\n SlideShare has different functionality for logged in and logged out users. We load only base files for logged out users and additional JS files when the user logs in. Similarly, the HTML5 player loads different type of combined JS files depending on the content type say presentations or documents. There is also a possibility that some plugins that you added initially are not being used anymore. Removing them is the first step towards minimizing size of assets that block page load.\r\n\r\n## 5. Defer loading of JS\r\n\r\nThe main component of SlideShare which is the HTML5 player needs to be loaded as fast as possible. For this we are dependent on document.ready event. Therefore,the JS that is required for above the fold functionality is minimal and is loaded quite early. The other JS that is required for additional user functionality is loaded after window.load.\r\n\r\n## 6. Lazy Load HTML and JS\r\n\r\nThis is a commonly used technique to show user generated content on page like comments etc only when the user interacts. We removed the inline html required for user actions like embed code and retrieved it on user click. This reduces the page size that the browser needs to parse and speeds up the load time.\r\n\r\n## 7. Use of Cache Busters\r\n\r\nAll the assets like images, sprites, javascript files should have a cachebuster appended at the end of the URL so that the browser can cache the assets and makes a new request only if cache buster has changed.\r\n\r\n## 8. Remove HTTPS calls from an http page\r\nThis can help you chop off a few milliseconds spent in SSL negotiation.\r\n\r\n## 9. DNS prefetching\r\nSlideShare uses multiple cdns to fetch various assets. We figured out that we can reduce DNS look up time by preresolving DNS in the browser.\r\n\r\n## 10. Redesigning HTML5 player\r\n Apart from these we also made certain improvements in our HTML5 player. The core of the SlideShare – HTML5 player is written in JavaScript using jQuery. The HTML5 player is a complex system which supports displaying presentations,documents , slidecasts and now Infographics too! To make a dent in the page load time by a good margin, we realized that we need to redesign the HTML5 player:\r\n\r\n* We started with the idea that the player should be able to display content even if JavaScript is disabled in the browser and JS should only be used to make the player alive.\r\n\r\n* All the markup was generated on the client side using javascript which led to a lot of DOM manipulation. This was resolved by moving markup creation logic to backend.\r\n\r\n* The layout of slides and other styling logic was rewritten so that CSS rules can be used effectively instead of relying on JS\r\n\r\n* To make the user experience delightful, we included the first slide in the markup itself so that it is triggered by the browser parser instead of waiting on JS.\r\n\r\n(Apoorvi Kapoor)","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}